<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Premium - StreamBob</title>
    
    <!-- Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.6.8/plyr.css">
    
    <!-- Ícones (Font Awesome) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #ff0000;
            --primary-hover: #cc0000;
            --primary-active: #990000;
            --dark-bg: #0f0f0f;
            --darker-bg: #080808;
            --light-text: #f5f5f5;
            --gray-text: #aaaaaa;
            --overlay-bg: rgba(0, 0, 0, 0.85);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--dark-bg);
            color: var(--light-text);
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: bold;
            color: var(--light-text);
        }
        
        .logo-icon {
            color: var(--primary-color);
        }
        
        .movie-info {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--darker-bg);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .movie-title {
            font-size: 22px;
            margin-bottom: 8px;
            color: var(--light-text);
        }
        
        .movie-meta {
            display: flex;
            gap: 15px;
            color: var(--gray-text);
            font-size: 14px;
        }
        
        #loader-wrapper {
            text-align: center;
            padding: 60px 20px;
            transition: opacity 0.5s ease;
            background: var(--darker-bg);
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .loading-text {
            margin-top: 20px;
            font-size: 16px;
            color: var(--gray-text);
        }
        
        #video-container {
            display: none;
            margin-top: 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        #promo-container {
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 50px 30px;
            background: var(--darker-bg);
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .promo-icon {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        .promo-title {
            font-size: 24px;
            margin-bottom: 15px;
            color: var(--light-text);
        }
        
        .promo-description {
            color: var(--gray-text);
            max-width: 500px;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        /* BOTÃO VERMELHO melhorado */
        .promo-button {
            background: var(--primary-color);
            color: white;
            padding: 15px 35px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 14px rgba(255, 0, 0, 0.35);
        }
        
        .promo-button:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(255, 0, 0, 0.4);
        }
        
        .promo-button:active {
            background: var(--primary-active);
            transform: translateY(0);
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .progress-bar {
            width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 20px auto;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            width: 0%;
            background: var(--primary-color);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: var(--gray-text);
            font-size: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* ===== CUSTOMIZAÇÃO AVANÇADA DO PLYR ===== */
        .plyr {
            --plyr-color-main: var(--primary-color);
            --plyr-video-controls-background: rgba(0, 0, 0, 0.8);
            --plyr-video-control-color: white;
            --plyr-menu-background: var(--darker-bg);
            --plyr-tooltip-background: var(--primary-color);
            --plyr-tooltip-color: white;
            border-radius: 8px;
        }
        
        .plyr--full-ui.plyr--video .plyr__control--overlaid {
            background: rgba(255, 0, 0, 0.85);
            padding: 25px;
        }
        
        .plyr--full-ui.plyr--video .plyr__control--overlaid:hover {
            background: var(--primary-color);
        }
        
        .plyr__control.plyr__control--overlaid {
            border-radius: 50%;
        }
        
        .plyr--video .plyr__controls {
            padding: 20px;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.85));
        }
        
        .plyr__progress__container {
            border-radius: 5px;
        }
        
        .plyr__tab-focus {
            box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.3);
        }
        
        /* Ajustes de responsividade */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .movie-meta {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .progress-bar {
                width: 200px;
            }
        }
        
        /* Animações suaves para transições de tela */
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .slide-down {
            animation: slideDown 0.5s ease forwards;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>

        
        <!-- Loader -->
        <div id="loader-wrapper">
            <div class="spinner"></div>
            <div class="loading-text">Preparando a melhor qualidade para você...</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div id="status-message">Carregando... 0%</div>
        </div>
        
        <!-- Video Container -->
        <div id="video-container">
            <video 
                id="player" 
                playsinline 
                controls 
                data-poster="https://cdn.plyr.io/static/demo/View_From_A_Blue_Moon_Trailer-HD.jpg">
                <!-- A fonte será adicionada via JavaScript -->
            </video>
        </div>
        


    <!-- Plyr JS -->
    <script src="https://cdn.plyr.io/3.6.8/plyr.polyfilled.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Inicia a barra de progresso animada
            animateProgressBar();
            // Inicia a busca pelo link do vídeo
            fetchVideoLink();
        });

        function animateProgressBar() {
            const progressFill = document.getElementById('progress-fill');
            let width = 0;
            const interval = setInterval(() => {
                if (width >= 90) {
                    clearInterval(interval);
                    return;
                }
                width += 5;
                progressFill.style.width = width + '%';
            }, 800);
        }

        async function fetchVideoLink() {
            const maxAttempts = 50;
            let attempt = 0;
            const statusElement = document.getElementById('status-message');
            const progressFill = document.getElementById('progress-fill');
            
            const apiUrl = `https://aniplay.online/Midias/HLS/Filmes/letra-K/Kimetsu%20no%20Yaiba%20Movie%20Mugen%20Jou-hen%20Dublado/01/01.m3u8`;

            while (attempt < maxAttempts) {
                attempt++;
                const progress = Math.min(90, Math.round((attempt / maxAttempts) * 90));
                progressFill.style.width = progress + '%';
                
                if (statusElement) {
                    statusElement.textContent = `Preparando transmissão... ${progress}%`;
                }

                try {
                    const response = await fetch(apiUrl + '&t=' + Date.now());
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                    const mp4Link = (await response.text()).trim();

                    if (!mp4Link || !isValidUrl(mp4Link)) {
                        throw new Error('URL inválida retornada pela API');
                    }

                    if (isBlocked(mp4Link)) {
                        showPromo();
                        return;
                    }

                    // Completa a barra de progresso
                    progressFill.style.width = '100%';
                    setTimeout(() => initPlayer(mp4Link), 500);
                    return;
                    
                } catch (error) {
                    console.error('Erro na tentativa', attempt, error);
                    if (attempt < maxAttempts) {
                        await new Promise(resolve => setTimeout(resolve, 2000));
                    }
                }
            }

            if (statusElement) {
                statusElement.textContent = 'Não foi possível carregar o vídeo. Recarregando...';
            }
            setTimeout(() => location.reload(), 3000);
        }

        function isValidUrl(string) {
            try { 
                new URL(string); 
                return true; 
            } catch (_) { 
                return false; 
            }
        }

        function isBlocked(url) {
            if (!url) return false;
            const clean = url.trim().toLowerCase();
            return clean.includes('block.com') || 
                   clean.includes('blocked') || 
                   clean.includes('private');
        }

        function showPromo() {
            const loaderWrapper = document.getElementById('loader-wrapper');
            const videoContainer = document.getElementById('video-container');
            const promo = document.getElementById('promo-container');

            if (loaderWrapper) {
                loaderWrapper.style.opacity = '0';
                setTimeout(() => {
                    loaderWrapper.style.display = 'none';
                    if (videoContainer) videoContainer.style.display = 'none';
                    if (promo) {
                        promo.style.display = 'flex';
                        promo.classList.add('fade-in');
                    }
                }, 500);
            }
        }

        function initPlayer(mp4Link) {
            const loaderWrapper = document.getElementById('loader-wrapper');
            const videoContainer = document.getElementById('video-container');
            const playerElement = document.getElementById('player');

            // Limpa quaisquer sources existentes
            while (playerElement.firstChild) {
                playerElement.removeChild(playerElement.firstChild);
            }

            // Adiciona a nova source
            const sourceElement = document.createElement('source');
            sourceElement.src = mp4Link;
            sourceElement.type = 'video/mp4';
            playerElement.appendChild(sourceElement);

            if (videoContainer) {
                videoContainer.style.display = 'block';
                videoContainer.classList.add('slide-down');
            }

            if (loaderWrapper) {
                loaderWrapper.style.opacity = '0';
                setTimeout(() => {
                    loaderWrapper.style.display = 'none';

                    // Inicializa o player Plyr
                    const player = new Plyr('#player', {
                        controls: [
                            'play-large', 
                            'play', 
                            'progress', 
                            'current-time', 
                            'duration', 
                            'mute', 
                            'volume', 
                            'captions', 
                            'settings', 
                            'pip', 
                            'fullscreen'
                        ],
                        hideControls: true,
                        autoplay: true,
                        seekTime: 10,
                        volume: 0.8,
                        tooltips: {
                            controls: true,
                            seek: true
                        }
                    });

                    // Tenta reproduzir automaticamente
                    player.play().catch(e => {
                        console.log('Auto-play não permitido, aguardando interação do usuário');
                    });

                    // Evento quando o vídeo está pronto
                    player.on('ready', event => {
                        console.log('Player pronto!');
                    });

                }, 500);
            }
        }
    </script>
</body>
</html>
